{"ast":null,"code":"import HASH from '../codes/hash';\nimport CONST from '../config/constant';\nimport apicc from '../helpers/apicc';\nimport { initialize } from 'zokrates-js';\n\nconst voting = async (toHash, setter, results, vote) => {\n  console.log(toHash);\n\n  const formatter = w => JSON.parse(w).map(x => '0x' + x.toString(16).padStart(8, \"0\"));\n\n  const hasher = await import('witness');\n  setter(1);\n  const to_witness = hasher.genHash(toHash);\n  const vote_hash = hasher.genHash(vote);\n  const nullifier = hasher.genNullifier(toHash);\n  const format_witness = formatter(to_witness);\n  const format_vote = formatter(vote_hash);\n  const format_nullifier = formatter(nullifier);\n  setter(2);\n  const zok = await initialize();\n  setter(3);\n  const systemArtifacts = await apicc.getArtifacts();\n  console.log(Object.keys(systemArtifacts));\n  console.log(systemArtifacts.voteConst);\n  setter(4);\n  const vote_sign = hasher.voteSign(vote, systemArtifacts.voteConst.value);\n  const format_sign = formatter(vote_sign);\n  const {\n    witness\n  } = zok.computeWitness(systemArtifacts.artifacts, [format_witness, systemArtifacts.voteRoll, format_vote, systemArtifacts.voteConst.hash, format_nullifier, format_sign]);\n  setter(5);\n  const proof = zok.generateProof(systemArtifacts.artifacts.program, witness, systemArtifacts.keyPairs.pk);\n  setter(6);\n  console.log(proof);\n  console.log(format_witness);\n  results(` proof: ${JSON.stringify(proof)}`);\n};\n\nexport default voting;","map":{"version":3,"sources":["/home/matias/Memoria/Demo/front-zk/app/src/utils/voting.js"],"names":["HASH","CONST","apicc","initialize","voting","toHash","setter","results","vote","console","log","formatter","w","JSON","parse","map","x","toString","padStart","hasher","to_witness","genHash","vote_hash","nullifier","genNullifier","format_witness","format_vote","format_nullifier","zok","systemArtifacts","getArtifacts","Object","keys","voteConst","vote_sign","voteSign","value","format_sign","witness","computeWitness","artifacts","voteRoll","hash","proof","generateProof","program","keyPairs","pk","stringify"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,eAAjB;AACA,OAAOC,KAAP,MAAkB,oBAAlB;AACA,OAAOC,KAAP,MAAkB,kBAAlB;AAEA,SAASC,UAAT,QAA2B,aAA3B;;AACA,MAAMC,MAAM,GAAG,OAAOC,MAAP,EAAeC,MAAf,EAAuBC,OAAvB,EAAgCC,IAAhC,KAAyC;AACpDC,EAAAA,OAAO,CAACC,GAAR,CAAYL,MAAZ;;AACA,QAAMM,SAAS,GAAGC,CAAC,IAAIC,IAAI,CAACC,KAAL,CAAWF,CAAX,EAAcG,GAAd,CAAmBC,CAAD,IAAM,OAAMA,CAAC,CAACC,QAAF,CAAW,EAAX,EAAeC,QAAf,CAAwB,CAAxB,EAA0B,GAA1B,CAA9B,CAAvB;;AACA,QAAMC,MAAM,GAAG,MAAM,OAAO,SAAP,CAArB;AACAb,EAAAA,MAAM,CAAC,CAAD,CAAN;AACA,QAAMc,UAAU,GAAGD,MAAM,CAACE,OAAP,CAAehB,MAAf,CAAnB;AACA,QAAMiB,SAAS,GAAGH,MAAM,CAACE,OAAP,CAAeb,IAAf,CAAlB;AACA,QAAMe,SAAS,GAAGJ,MAAM,CAACK,YAAP,CAAoBnB,MAApB,CAAlB;AACA,QAAMoB,cAAc,GAAGd,SAAS,CAACS,UAAD,CAAhC;AACA,QAAMM,WAAW,GAAGf,SAAS,CAACW,SAAD,CAA7B;AACA,QAAMK,gBAAgB,GAAGhB,SAAS,CAACY,SAAD,CAAlC;AACAjB,EAAAA,MAAM,CAAC,CAAD,CAAN;AACA,QAAMsB,GAAG,GAAG,MAAMzB,UAAU,EAA5B;AACAG,EAAAA,MAAM,CAAC,CAAD,CAAN;AACA,QAAMuB,eAAe,GAAG,MAAM3B,KAAK,CAAC4B,YAAN,EAA9B;AACArB,EAAAA,OAAO,CAACC,GAAR,CAAYqB,MAAM,CAACC,IAAP,CAAYH,eAAZ,CAAZ;AACApB,EAAAA,OAAO,CAACC,GAAR,CAAYmB,eAAe,CAACI,SAA5B;AACA3B,EAAAA,MAAM,CAAC,CAAD,CAAN;AACA,QAAM4B,SAAS,GAAGf,MAAM,CAACgB,QAAP,CAAgB3B,IAAhB,EAAsBqB,eAAe,CAACI,SAAhB,CAA0BG,KAAhD,CAAlB;AACA,QAAMC,WAAW,GAAG1B,SAAS,CAACuB,SAAD,CAA7B;AACA,QAAM;AAAEI,IAAAA;AAAF,MAAcV,GAAG,CAACW,cAAJ,CAAmBV,eAAe,CAACW,SAAnC,EAChB,CACIf,cADJ,EAEII,eAAe,CAACY,QAFpB,EAGIf,WAHJ,EAIIG,eAAe,CAACI,SAAhB,CAA0BS,IAJ9B,EAKIf,gBALJ,EAMIU,WANJ,CADgB,CAApB;AAUA/B,EAAAA,MAAM,CAAC,CAAD,CAAN;AACA,QAAMqC,KAAK,GAAGf,GAAG,CAACgB,aAAJ,CAAkBf,eAAe,CAACW,SAAhB,CAA0BK,OAA5C,EAAqDP,OAArD,EAA8DT,eAAe,CAACiB,QAAhB,CAAyBC,EAAvF,CAAd;AACAzC,EAAAA,MAAM,CAAC,CAAD,CAAN;AACAG,EAAAA,OAAO,CAACC,GAAR,CAAYiC,KAAZ;AACAlC,EAAAA,OAAO,CAACC,GAAR,CAAYe,cAAZ;AACAlB,EAAAA,OAAO,CAAE,WAAUM,IAAI,CAACmC,SAAL,CAAeL,KAAf,CAAsB,EAAlC,CAAP;AACH,CApCD;;AAsCA,eAAevC,MAAf","sourcesContent":["import HASH from '../codes/hash';\nimport CONST from '../config/constant';\nimport apicc from '../helpers/apicc';\n\nimport { initialize } from 'zokrates-js';\nconst voting = async (toHash, setter, results, vote) => {\n    console.log(toHash);\n    const formatter = w => JSON.parse(w).map((x) =>'0x'+ x.toString(16).padStart(8,\"0\"));\n    const hasher = await import('witness');\n    setter(1);\n    const to_witness = hasher.genHash(toHash);\n    const vote_hash = hasher.genHash(vote);\n    const nullifier = hasher.genNullifier(toHash);\n    const format_witness = formatter(to_witness);\n    const format_vote = formatter(vote_hash);\n    const format_nullifier = formatter(nullifier);\n    setter(2);\n    const zok = await initialize();\n    setter(3);\n    const systemArtifacts = await apicc.getArtifacts();\n    console.log(Object.keys(systemArtifacts));\n    console.log(systemArtifacts.voteConst);\n    setter(4);\n    const vote_sign = hasher.voteSign(vote, systemArtifacts.voteConst.value);\n    const format_sign = formatter(vote_sign);\n    const { witness } = zok.computeWitness(systemArtifacts.artifacts,\n        [\n            format_witness,\n            systemArtifacts.voteRoll,\n            format_vote,\n            systemArtifacts.voteConst.hash,\n            format_nullifier,\n            format_sign,\n        ],\n    );\n    setter(5);\n    const proof = zok.generateProof(systemArtifacts.artifacts.program, witness, systemArtifacts.keyPairs.pk);\n    setter(6);\n    console.log(proof);\n    console.log(format_witness);\n    results(` proof: ${JSON.stringify(proof)}`);\n}\n\nexport default voting;\n"]},"metadata":{},"sourceType":"module"}